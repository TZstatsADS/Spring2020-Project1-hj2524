---
title: "Project1-hj2524"
author: "Hanbo JIAO"
date: "2020/1/30"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```




### Step 0 - Load all the required libraries

From the packages' descriptions:

+ `tm` is a framework for text mining applications within R;
+ `data.table` is a package for fast aggregation of large data;
+ `tidyverse` is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures;
+ `tidytext` allows text mining using 'dplyr', 'ggplot2', and other tidy tools;
+ `DT` provides an R interface to the JavaScript library DataTables.

```{r load libraries, warning=FALSE, message=FALSE}
install.packages("textdata")
library(tm)
library(data.table)
library(tidytext)
library(tidyverse)
library(DT)
library(wordcloud)
library(RColorBrewer)

```

### Step 1 - Load the data to be cleaned and processed,

```{r}
# load lyrics data
load('../output/processed_lyrics.RData')
artists <- read_csv("~/GitHub/Spring2020-Project1-hj2524/data/artists.csv")
team_list<-artists%>%select(-Intro,-Origin)%>%filter(!is.na(Formed)|!is.na(Members))%>%filter(is.na(Formed)|!Formed==199)%>%pull(Artist)
data<-dt_lyrics%>%mutate(team=artist%in%team_list)%>%filter(year>1000)%>%
  mutate(  year=fct_recode(cut(year-1900,breaks=seq(60,120,10)), 
                                    "60s" = "(60,70]",
                                    "70s" = "(70,80]",
                                    "80s" = "(80,90]",
                                    "90s" = "(90,100]",
                                    "00s" = "(100,110]",
                                    "10s" = "(110,120]")    )
```



#function    1. tdm  2. wordplot without "love"
```{r}
tdm<-function(data){
  corpus<-VCorpus(VectorSource(data$stemmedwords))
  tdm.all<-TermDocumentMatrix(tm_map(corpus, stemDocument))
  tdm.tidy=tidy(tdm.all)
  tdm.overall=summarise(group_by(tdm.tidy, term), sum(count))
  return(tdm.overall)
}


wordcloudplot<-function(data){
    tdm.overall_nolove<-data%>%filter(term!="love")
  wordcloud(tdm.overall_nolove$term, tdm.overall_nolove$`sum(count)`,
            scale=c(5,0.5),
            max.words=100,
            min.freq=1,
            random.order=FALSE,
            rot.per=0.3,
            use.r.layout=T,
            random.color=FALSE,
            colors=brewer.pal(9,"Blues"))
}

```




#plot and tdm  for pop music

```{r,fig.height=6, fig.width=6}
data_Pop<-data%>%filter(genre%in% c("Pop"))

tdm_Pop=tdm(data_Pop)
wordcloudplot(tdm_Pop)

```

# team and individual
```{r,fig.height=6, fig.width=6}

data_team_P<-data_Pop%>%filter(team)
data_indiv_P<-data_Pop%>%filter(!team)


wordcloudplot(data_team_P)
wordcloudplot(data_indiv_P)



```





#sentiment



```{r}
library(janeaustenr)
library(dplyr)
library(stringr)



nrc <- get_sentiments("nrc") 
tdm_Pop%>%inner_join(nrc,by=c("term"="word"))
```




```{r}


```









```{r}



tidy_books %>%
  filter(book == "Emma") %>%
  inner_join(nrc_joy) %>%
  count(word, sort = TRUE)















```

